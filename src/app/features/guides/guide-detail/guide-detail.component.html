<div *ngIf="guide$ | async as guide; else loading" class="p-4">
  <button mat-flat-button color="primary" class="mb-4 back-button" routerLink="/guides">
    <mat-icon class="align-middle mr-1">arrow_back</mat-icon>
    Retour à la liste des guides
  </button>

  <mat-card class="mb-4 p-6 bg-gray-800 text-white shadow-lg rounded-lg">
    <h1 class="text-3xl font-bold">{{ guide.title }}</h1>
    <p class="mt-2 text-gray-300">{{ guide.description }}</p>

    <div class="mt-3 space-y-1 text-sm text-gray-400">
      <p><mat-icon class="align-middle mr-1">today</mat-icon> Jours : {{ guide.daysCount }}</p>
      <p>
        <mat-icon class="align-middle mr-1">directions_walk</mat-icon> Mobilités :
        {{ guide.mobilityOptions.map(getTranslatedMobility).join(', ') }}
      </p>
      <p>
        <mat-icon class="align-middle mr-1">wb_sunny</mat-icon> Saisons :
        {{ guide.seasons.map(getTranslatedSeason).join(', ') }}
      </p>
      <p>
        <mat-icon class="align-middle mr-1">groups</mat-icon> Public :
        {{ guide.audiences.map(getTranslatedAudience).join(', ') }}
      </p>
    </div>
  </mat-card>

  <h2 class="text-2xl font-semibold mb-4">Planning par jour</h2>

  <mat-accordion *ngIf="activitiesByDay$ | async as activitiesByDay" multi>
    <mat-expansion-panel
      class="panel-guide-detail"
      *ngFor="let day of activitiesByDay | keyvalue; trackBy: trackByDay"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>Jour {{ day.key }}</mat-panel-title>
        <mat-panel-description>
          {{ day.value.length }} activité{{ day.value.length > 1 ? 's' : '' }}
        </mat-panel-description>
      </mat-expansion-panel-header>

      <div>
        <mat-card
          *ngFor="let activity of day.value; trackBy: trackByActivity"
          class="activity-card p-3 cursor-pointer hover:shadow-2xl transition-transform bg-gray-700 text-white"
          [routerLink]="['/guides', guide.id, 'activities', activity.id]"
        >
          <h3 class="font-semibold text-lg">{{ activity.title }}</h3>
          <p class="text-gray-300 text-sm">
            {{ activity.description | slice : 0 : 100
            }}{{ activity.description.length > 100 ? '...' : '' }}
          </p>
          <p class="text-xs text-gray-400 mt-1">Catégorie : {{ activity.category }}</p>
          <p class="text-xs text-gray-400 flex items-center" *ngIf="activity.address">
            <mat-icon class="mr-1">location_on</mat-icon> {{ activity.address }}
          </p>
          <p class="text-xs text-gray-400 flex items-center" *ngIf="activity.phone">
            <mat-icon class="mr-1">phone</mat-icon> {{ activity.phone }}
          </p>
          <p class="text-xs text-gray-400 flex items-center" *ngIf="activity.website">
            <mat-icon class="mr-1">link</mat-icon>
            <a href="{{ activity.website }}" target="_blank" class="underline text-blue-400">{{
              activity.website
            }}</a>
          </p>
        </mat-card>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>

<ng-template #loading>
  <p class="text-center text-gray-400 mt-6">Chargement du guide...</p>
</ng-template>
